stages:
    - test_cto5.3
    - test_cto5.2
    - test_cto5.1
    - test_cto5.0

test_cto5.3_php8.4:
    stage: test_cto5.4
    rules:
        -   if: $CI_COMMIT_BRANCH == "main"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "nightly"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "dev"
            when: on_success
        -   if: $CI_PIPELINE_SOURCE == "merge_request_event"
            when: on_success
        -   if: $CI_BUILD_TAG
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-dz"
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-pf"
            when: on_success
    image: registry.netgroup.de/testsuite_cto5.3_php8.4:1.0.1
    variables:
        GIT_STRATEGY: none
        PROJECT_NAME: netgroup/userguide
    before_script:
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.composer composer $TEST_PACKAGE_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.testproject vcs $TEST_PROJECT_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar require $PROJECT_NAME:dev-$CI_COMMIT_REF_NAME --working-dir=/htdocs/
    script:
        - cd /htdocs/vendor/$PROJECT_NAME/
        - ./build/runtests.sh
    coverage: '/Methods: \d+\.\d+/'

test_cto5.3_php8.3:
    stage: test_cto5.3
    rules:
        -   if: $CI_COMMIT_BRANCH == "main"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "nightly"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "dev"
            when: on_success
        -   if: $CI_PIPELINE_SOURCE == "merge_request_event"
            when: on_success
        -   if: $CI_BUILD_TAG
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-dz"
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-pf"
            when: on_success
    image: registry.netgroup.de/testsuite_cto5.3_php8.3:1.0.1
    variables:
        GIT_STRATEGY: none
        PROJECT_NAME: netgroup/userguide
    before_script:
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.composer composer $TEST_PACKAGE_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.testproject vcs $TEST_PROJECT_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar require $PROJECT_NAME:dev-$CI_COMMIT_REF_NAME --working-dir=/htdocs/
    script:
        - cd /htdocs/vendor/$PROJECT_NAME/
        - ./build/runtests.sh
    coverage: '/Methods: \d+\.\d+/'

test_cto5.3_php8.2:
    stage: test_cto5.3
    rules:
        -   if: $CI_COMMIT_BRANCH == "main"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "nightly"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "dev"
            when: on_success
        -   if: $CI_PIPELINE_SOURCE == "merge_request_event"
            when: on_success
        -   if: $CI_BUILD_TAG
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-dz"
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-pf"
            when: on_success
    image: registry.netgroup.de/testsuite_cto5.3_php8.2:1.0.1
    variables:
        GIT_STRATEGY: none
        PROJECT_NAME: netgroup/userguide
    before_script:
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.composer composer $TEST_PACKAGE_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.testproject vcs $TEST_PROJECT_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar require $PROJECT_NAME:dev-$CI_COMMIT_REF_NAME --working-dir=/htdocs/
    script:
        - cd /htdocs/vendor/$PROJECT_NAME/
        - ./build/runtests.sh
    coverage: '/Methods: \d+\.\d+/'

test_cto5.2_php8.3:
    stage: test_cto5.2
    rules:
        -   if: $CI_COMMIT_BRANCH == "main"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "nightly"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "dev"
            when: on_success
        -   if: $CI_PIPELINE_SOURCE == "merge_request_event"
            when: on_success
        -   if: $CI_BUILD_TAG
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-dz"
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-pf"
            when: on_success
    image: registry.netgroup.de/testsuite_cto5.2_php8.3:1.0.1
    variables:
        GIT_STRATEGY: none
        PROJECT_NAME: netgroup/userguide
    before_script:
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.composer composer $TEST_PACKAGE_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.testproject vcs $TEST_PROJECT_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar require $PROJECT_NAME:dev-$CI_COMMIT_REF_NAME --working-dir=/htdocs/
    script:
        - cd /htdocs/vendor/$PROJECT_NAME/
        - ./build/runtests.sh
    coverage: '/Methods: \d+\.\d+/'

test_cto5.2_php8.2:
    stage: test_cto5.2
    rules:
        -   if: $CI_COMMIT_BRANCH == "main"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "nightly"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "dev"
            when: on_success
        -   if: $CI_PIPELINE_SOURCE == "merge_request_event"
            when: on_success
        -   if: $CI_BUILD_TAG
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-dz"
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-pf"
            when: on_success
    image: registry.netgroup.de/testsuite_cto5.2_php8.2:1.0.1
    variables:
        GIT_STRATEGY: none
        PROJECT_NAME: netgroup/userguide
    before_script:
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.composer composer $TEST_PACKAGE_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.testproject vcs $TEST_PROJECT_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar require $PROJECT_NAME:dev-$CI_COMMIT_REF_NAME --working-dir=/htdocs/
    script:
        - cd /htdocs/vendor/$PROJECT_NAME/
        - ./build/runtests.sh
    coverage: '/Methods: \d+\.\d+/'

test_cto5.1_php8.3:
    stage: test_cto5.1
    rules:
        -   if: $CI_COMMIT_BRANCH == "main"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "nightly"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "dev"
            when: on_success
        -   if: $CI_PIPELINE_SOURCE == "merge_request_event"
            when: on_success
        -   if: $CI_BUILD_TAG
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-dz"
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-pf"
            when: on_success
    image: registry.netgroup.de/testsuite_cto5.1_php8.3:1.0.1
    variables:
        GIT_STRATEGY: none
        PROJECT_NAME: netgroup/userguide
    before_script:
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.composer composer $TEST_PACKAGE_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.testproject vcs $TEST_PROJECT_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar require $PROJECT_NAME:dev-$CI_COMMIT_REF_NAME --working-dir=/htdocs/
    script:
        - cd /htdocs/vendor/$PROJECT_NAME/
        - ./build/runtests.sh
    coverage: '/Methods: \d+\.\d+/'

test_cto5.1_php8.2:
    stage: test_cto5.1
    rules:
        -   if: $CI_COMMIT_BRANCH == "main"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "nightly"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "dev"
            when: on_success
        -   if: $CI_PIPELINE_SOURCE == "merge_request_event"
            when: on_success
        -   if: $CI_BUILD_TAG
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-dz"
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-pf"
            when: on_success
    image: registry.netgroup.de/testsuite_cto5.1_php8.2:1.0.1
    variables:
        GIT_STRATEGY: none
        PROJECT_NAME: netgroup/userguide
    before_script:
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.composer composer $TEST_PACKAGE_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.testproject vcs $TEST_PROJECT_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar require $PROJECT_NAME:dev-$CI_COMMIT_REF_NAME --working-dir=/htdocs/
    script:
        - cd /htdocs/vendor/$PROJECT_NAME/
        - ./build/runtests.sh
    coverage: '/Methods: \d+\.\d+/'

test_cto5.0_php8.3:
    stage: test_cto5.0
    rules:
        -   if: $CI_COMMIT_BRANCH == "main"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "nightly"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "dev"
            when: on_success
        -   if: $CI_PIPELINE_SOURCE == "merge_request_event"
            when: on_success
        -   if: $CI_BUILD_TAG
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-dz"
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-pf"
            when: on_success
    image: registry.netgroup.de/testsuite_cto5.0_php8.3:1.0.1
    variables:
        GIT_STRATEGY: none
        PROJECT_NAME: netgroup/userguide
    before_script:
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.composer composer $TEST_PACKAGE_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.testproject vcs $TEST_PROJECT_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar require $PROJECT_NAME:dev-$CI_COMMIT_REF_NAME --working-dir=/htdocs/
    script:
        - cd /htdocs/vendor/$PROJECT_NAME/
        - ./build/runtests.sh
    coverage: '/Methods: \d+\.\d+/'

test_cto5.0_php8.2:
    stage: test_cto5.0
    rules:
        -   if: $CI_COMMIT_BRANCH == "main"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "nightly"
            when: on_success
        -   if: $CI_COMMIT_BRANCH == "dev"
            when: on_success
        -   if: $CI_PIPELINE_SOURCE == "merge_request_event"
            when: on_success
        -   if: $CI_BUILD_TAG
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-dz"
            when: never
        -   if: $CI_COMMIT_BRANCH == "dev-pf"
            when: on_success
    image: registry.netgroup.de/testsuite_cto5.0_php8.2:1.0.1
    variables:
        GIT_STRATEGY: none
        PROJECT_NAME: netgroup/userguide
    before_script:
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.composer composer $TEST_PACKAGE_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar config repositories.testproject vcs $TEST_PROJECT_URL --working-dir=/htdocs/
        - COMPOSER_MEMORY_LIMIT=-1 /usr/local/bin/composer.phar require $PROJECT_NAME:dev-$CI_COMMIT_REF_NAME --working-dir=/htdocs/
    script:
        - cd /htdocs/vendor/$PROJECT_NAME/
        - ./build/runtests.sh
    coverage: '/Methods: \d+\.\d+/'
